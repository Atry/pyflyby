#!/usr/bin/env python
"""
collect-imports *.py
collect-imports < foo.py

Collect all imports from named files or stdin, and combine them into a single
block of import statements.  Print the result to stdout.

"""

from __future__ import absolute_import, division, with_statement

import optparse
import os
import sys

from pyflyby.file       import Filename
from pyflyby.importstmt import Imports

def syntax():
    print >>sys.stderr, __doc__
    raise SystemExit(1)

def parse_args():
    parser = optparse.OptionParser()
    return parser.parse_args() # options, args

def main():
    options, args = parse_args()
    if args:
        input = [Filename(arg) for arg in args]
    else:
        if os.isatty(0):
            syntax()
        input = sys.stdin.read()
    imports = Imports.from_code(input, filter_nonimports=True)
    sys.stdout.write(imports.pretty_print(allow_conflicts=True))


if __name__ == '__main__':
    main()

