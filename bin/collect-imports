#!/usr/bin/env python
"""
collect-imports *.py
collect-imports < foo.py

Collect all imports from named files or stdin, and combine them into a single
block of import statements.  Print the result to stdout.

"""

from __future__ import absolute_import, division, with_statement

import sys

from   pyflyby.cmdline          import filename_args, hfmt, parse_args
from   pyflyby.file             import read_file
from   pyflyby.importdb         import global_known_imports
from   pyflyby.importstmt       import Imports

def main():
    def addopts(parser):
        parser.add_option("--ignore-known", default=False, action='store_true',
                          help=hfmt('''
                                Don't list imports already in the
                                known-imports database.'''))
        parser.add_option("--no-ignore-known", dest="ignore_known",
                          action='store_false',
                          help=hfmt('''
                                (Default) List all imports, including those
                                already in the known-imports database.'''))
    options, args = parse_args(addopts, import_format_params=True)
    contents = [read_file(fn) for fn in filename_args(args)]
    imports = Imports.from_code(contents, filter_nonimports=True)
    if options.ignore_known:
        db = global_known_imports()
        imports = imports.without_imports(db, strict=False)
    sys.stdout.write(imports.pretty_print(
            allow_conflicts=True, params=options.params))


if __name__ == '__main__':
    main()
